#!/bin/bash
function LITE_BOOT_SYSTEM() {
	
	sys_log "boot" "System run signal received."

	if [[ -f "$BOOTREFUSE" ]]; then
		sys_log "boot" "There was boot refuse flag."
		rm -f "$BOOTREFUSE"
		sys_log "boot" "Flag removed."
	fi

	export BOOTARGS="${BOOTARGS} $1 $2 $3 $4 $5 $6 $7 $8 $9"
	if [[ -f "$NVRAM/boot-arguments" ]]; then
		export BOOTARGS="$BOOTARGS $(<"$NVRAM/boot-arguments")"
	fi
	sys_log "boot" "Boot arguments: $BOOTARGS"

	while [[ true ]]; do
		clear
		sys_log "boot" "Starting Hermes Pro..."
		verbose "[${GREEN}*${C_DEFAULT}] Starting Hermes Pro..."
		
		if [[ -f "$SYSTEM/Firmware/HL/init" ]]; then
			LITE_CLEAR_BOOTSTAGE
			"$SYSTEM/Firmware/HL/init"
			if [[ "$?" == 0 ]]; then
				sys_log "boot" "Shutdown signal received..."
				break
			elif [[ "$?" == 127 ]]; then
				sys_log "boot" "System Crash!"
				verbose "[!] System Crash!!"
				break
			fi
			if [[ -f "$NVRAM/boot-arguments" ]]; then
				export BOOTARGS="$(<"$NVRAM/boot-arguments")"
			else
				export BOOTARGS=""
			fi
		else
			LITE_START
		fi
	done
	OSEND
}

export -f LITE_BOOT_SYSTEM